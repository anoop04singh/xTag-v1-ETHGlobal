datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                  String   @id @default(cuid())
  nfcId               String   @unique
  smartAccountAddress String   @unique
  encryptedSignerKey  String
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  createdSubscriptions Subscription[]     @relation("Creator")
  subscriptions        UserSubscription[]
}

model Subscription {
  id          String   @id @default(cuid())
  name        String
  description String
  price       Float // Stored in USDC
  interval    String // e.g., "monthly", "yearly"
  creatorId   String
  creator     User     @relation("Creator", fields: [creatorId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  subscribers UserSubscription[]
}

model UserSubscription {
  id             String       @id @default(cuid())
  userId         String
  user           User         @relation(fields: [userId], references: [id])
  subscriptionId String
  subscription   Subscription @relation(fields: [subscriptionId], references: [id])
  status         String // "active", "cancelled", "payment_failed"
  startDate      DateTime
  nextBillingDate DateTime
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([userId, subscriptionId])
}